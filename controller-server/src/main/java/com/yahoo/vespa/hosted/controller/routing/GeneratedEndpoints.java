package com.yahoo.vespa.hosted.controller.routing;

import com.yahoo.config.provision.ClusterSpec;
import com.yahoo.vespa.hosted.controller.application.GeneratedEndpoint;

import java.util.List;
import java.util.Map;
import java.util.Objects;

/**
 * This represents endpoints generated by the controller for a deployment, grouped by their assigned cluster.
 *
 * @author mpolden
 */
public record GeneratedEndpoints(Map<ClusterSpec.Id, List<GeneratedEndpoint>> endpoints) {

    public static final GeneratedEndpoints empty = new GeneratedEndpoints(Map.of());

    public GeneratedEndpoints(Map<ClusterSpec.Id, List<GeneratedEndpoint>> endpoints) {
        this.endpoints = Map.copyOf(Objects.requireNonNull(endpoints));
        endpoints.forEach((cluster, generatedEndpoints) -> {
            if (generatedEndpoints.stream().distinct().count() != generatedEndpoints.size()) {
                throw new IllegalStateException("Endpoints for " + cluster + " must be distinct, got " + generatedEndpoints);
            }
        });
    }

    public List<GeneratedEndpoint> cluster(ClusterSpec.Id cluster) {
        return endpoints.getOrDefault(cluster, List.of());
    }

}
